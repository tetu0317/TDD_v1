# ドキュメント管理ツール テスト仕様書

## 1. テスト概要

| 項目 | 内容 |
|------|------|
| 対象システム | ドキュメント管理ツール v1.0 |
| テスト範囲 | 文書検索機能 |
| 開発環境 | Electron + HTML/CSS/JavaScript |
| テストフレームワーク | Jest |
| テスト実行環境 | Node.js + Electron |

## 2. テストケース一覧

### 2.1 DocumentSearcher クラス - 単体テスト

#### TC_001: コンストラクタテスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `constructor()` |
| **ケースID** | TC_001 |
| **事前条件（試験規格）** | DocumentSearcherクラスが定義されている |
| **判定条件（試験合格値）** | インスタンスが正常に生成され、documents配列が空配列で初期化される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- `new DocumentSearcher()`でインスタンス生成可能
- `documents`プロパティが空配列`[]`である

---

#### TC_002: ドキュメント追加テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `addDocument(title, path, content)` |
| **ケースID** | TC_002 |
| **事前条件（試験規格）** | DocumentSearcherインスタンスが生成済み |
| **判定条件（試験合格値）** | ドキュメントオブジェクトが配列に追加され、返り値がtrueである |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- 引数: `title="設計書.txt"`, `path="/docs/design.txt"`, `content="設計内容"`
- documents配列に1件追加される
- 追加されたオブジェクトは`{title, path, content}`の構造
- 返り値が`true`

---

#### TC_003: 単一キーワード検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_003 |
| **事前条件（試験規格）** | 3つのドキュメントが登録済み（"設計書.txt", "仕様書.txt", "議事録.txt"） |
| **判定条件（試験合格値）** | キーワード"設計"で検索時、"設計書.txt"のみが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
documents = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" },
  { title: "議事録.txt", path: "/documents/minutes.txt", content: "会議の内容と決定事項。" }
]
```

**検証項目:**
- `search("設計")`の結果が配列である
- 結果の長さが1
- 結果[0].titleが"設計書.txt"

---

#### TC_004: 複数結果検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_004 |
| **事前条件（試験規格）** | 内容に"システム"を含む複数ドキュメントが登録済み |
| **判定条件（試験合格値）** | 該当する全ドキュメントが配列で返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
documents = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" },
  { title: "議事録.txt", path: "/documents/minutes.txt", content: "会議の内容と決定事項。" }
]
```

**検証項目:**
- `search("システム")`の結果が配列である
- 結果の長さが2（"設計書.txt"と"仕様書.txt"）
- 全ての結果にcontentフィールドに"システム"が含まれる

---

#### TC_005: 検索結果なしテスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_005 |
| **事前条件（試験規格）** | ドキュメントが登録済み |
| **判定条件（試験合格値）** | 存在しないキーワードで検索時、空配列が返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `search("存在しないキーワード")`の結果が空配列`[]`
- 結果の長さが0

---

#### TC_006: 空文字検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_006 |
| **事前条件（試験規格）** | ドキュメントが登録済み |
| **判定条件（試験合格値）** | 空文字で検索時、全ドキュメントが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `search("")`の結果が全ドキュメントの配列
- 結果の長さが登録済みドキュメント数と一致

---

### 2.2 FileReader クラス - 単体テスト

#### TC_007: ファイル読み込み成功テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `readFile(path)` |
| **ケースID** | TC_007 |
| **事前条件（試験規格）** | 指定パスにtxtファイルが存在する |
| **判定条件（試験合格値）** | ファイル内容が文字列として返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- テスト用ファイルを一時的に作成
- `readFile(path)`の返り値が文字列
- 返り値がファイルの実際の内容と一致

---

#### TC_008: ファイル読み込み失敗テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `readFile(path)` |
| **ケースID** | TC_008 |
| **事前条件（試験規格）** | 指定パスにファイルが存在しない |
| **判定条件（試験合格値）** | エラーがthrowされ、エラーメッセージに"File not found"が含まれる |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- 存在しないパスを指定
- `readFile("/non/existent/path.txt")`がエラーをthrow
- エラーメッセージに"File not found"または"ENOENT"が含まれる

---

### 2.3 UIController クラス - 統合テスト

#### TC_009: 検索結果表示テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `displaySearchResults(results)` |
| **ケースID** | TC_009 |
| **事前条件（試験規格）** | DOM要素が準備済み、検索結果2件 |
| **判定条件（試験合格値）** | 結果リストに2つのアイテムが表示され、タイトルとパスが正しく表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
results = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" }
]
```

**検証項目:**
- DOM環境をjsdomでシミュレート
- 結果表示エリアに2つのリストアイテムが存在
- 各アイテムにタイトルとパスが正しく表示される

---

#### TC_010: ドキュメント表示テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `displayDocument(path)` |
| **ケースID** | TC_010 |
| **事前条件（試験規格）** | パスリンクがクリック可能状態 |
| **判定条件（試験合格値）** | クリック時に該当ドキュメントの内容が表示エリアに表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**検証項目:**
- FileReaderのモックを使用
- `displayDocument("/documents/design.txt")`を実行
- 表示エリアにドキュメント内容が表示される

---

#### TC_011: 検索実行テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `handleSearch()` |
| **ケースID** | TC_011 |
| **事前条件（試験規格）** | 検索フォームに"テスト"と入力済み |
| **判定条件（試験合格値）** | 検索ボタンクリック時、"テスト"を含むドキュメントが結果表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**検証項目:**
- DocumentSearcherのモックを使用
- 検索フォームに"テスト"を入力
- `handleSearch()`を実行
- `displaySearchResults()`が呼ばれる

---

### 2.4 E2Eテスト

#### TC_012: 検索から表示までの一連操作

| 項目 | 内容 |
|------|------|
| **メソッド名** | E2E シナリオ |
| **ケースID** | TC_012 |
| **事前条件（試験規格）** | アプリケーション起動済み、サンプルドキュメント3件登録済み |
| **判定条件（試験合格値）** | 1. 検索欄に入力<br>2. 検索実行<br>3. 結果表示確認<br>4. パスクリック<br>5. 内容表示確認 |
| **テスト分類** | E2Eテスト |
| **優先度** | 高 |

**テストシナリオ:**
1. アプリケーションを起動
2. サンプルドキュメント3件を登録
3. 検索欄に"システム"と入力
4. 検索ボタンをクリック
5. 検索結果に2件表示されることを確認
6. 1件目のパスリンクをクリック
7. ドキュメント内容が表示エリアに表示されることを確認

**検証項目:**
- 全ての操作が正常に完了
- 各ステップで期待される状態になっている

---

## 3. テスト実行計画

### 3.1 実行順序

1. **単体テスト**（TC_001～TC_008）
   - DocumentSearcher クラス
   - FileReader クラス

2. **統合テスト**（TC_009～TC_011）
   - UIController クラス

3. **E2Eテスト**（TC_012）
   - 全体シナリオ

### 3.2 テストデータ

**サンプルドキュメント:**
```javascript
const testDocuments = [
  {
    title: "設計書.txt",
    path: "/documents/design.txt",
    content: "システム設計に関する文書です。"
  },
  {
    title: "仕様書.txt",
    path: "/documents/spec.txt",
    content: "機能仕様とシステム要件を記載。"
  },
  {
    title: "議事録.txt",
    path: "/documents/minutes.txt",
    content: "会議の内容と決定事項。"
  }
];
```

### 3.3 テスト環境

| 項目 | 内容 |
|------|------|
| OS | Linux / macOS / Windows |
| Node.js | v16以上 |
| Jest | v29以上 |
| Electron | v27以上 |
| テスト実行コマンド | `npm test` |

---

## 4. 判定基準

### 4.1 合格基準

- ✅ 全テストケース（TC_001～TC_012）が成功
- ✅ コードカバレッジ80%以上
- ✅ 重要機能（検索、ファイル読み込み）のカバレッジ100%
- ✅ エラーハンドリングが適切に実装されている

### 4.2 不合格時の対応

1. 失敗テストケースの原因調査
2. コードまたはテストの修正
3. 修正後、全テスト再実行
4. リグレッションテストの実施（既存テストが引き続き成功するか確認）

### 4.3 カバレッジ目標

| 分類 | 目標 |
|------|------|
| 全体 | 80%以上 |
| DocumentSearcher | 100% |
| FileReader | 100% |
| UIController | 80%以上 |

---

## 5. テストの独立性

### 5.1 原則

- 各テストは独立して実行可能
- テスト間の依存関係を排除
- テストデータの初期化・クリーンアップを確実に実施

### 5.2 実装方針

- `beforeEach`: 各テスト前にインスタンスを初期化
- `afterEach`: 各テスト後にモックをクリア
- 一時ファイルはテスト後に削除

---

## 6. 今後の拡張予定

### 6.1 次期バージョンでの追加テスト

| テスト項目 | 説明 | 優先度 |
|-----------|------|--------|
| docxファイル対応テスト | Word文書の読み込みと検索 | 高 |
| テスト結果のxlsxファイル出力 | テスト結果をExcel形式で出力 | 中 |
| 複数ファイル形式の混在テスト | txt, docx, pdf混在環境 | 中 |
| パフォーマンステスト | 1000件以上のドキュメント検索 | 低 |
| セキュリティテスト | XSS、パストラバーサル対策 | 高 |

### 6.2 継続的改善

- テストケースの定期的なレビュー
- カバレッジの向上
- テスト実行時間の短縮
- CI/CDパイプラインへの統合

---

## 7. 付録

### 7.1 テスト実行コマンド

```bash
# 全テスト実行
npm test

# カバレッジ付き実行
npm test -- --coverage

# 特定のテストのみ実行
npm test -- 単体テスト
npm test -- 統合テスト
npm test -- E2Eテスト

# ウォッチモード
npm test -- --watch
```

### 7.2 参考資料

- [Jest公式ドキュメント](https://jestjs.io/)
- [Electron Testing Guide](https://www.electronjs.org/docs/latest/tutorial/testing)
- TDD実施要領: `/TDD_v1/CLAUDE.md`

---

**作成日:** 2025-11-19
**バージョン:** 1.0
**作成者:** Claude Code
