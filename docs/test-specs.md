# ドキュメント管理ツール テスト仕様書

## 1. テスト概要

| 項目 | 内容 |
|------|------|
| 対象システム | ドキュメント管理ツール v1.0 |
| テスト範囲 | 文書検索機能 |
| 開発環境 | Electron + HTML/CSS/JavaScript |
| テストフレームワーク | Jest |
| テスト実行環境 | Node.js + Electron |

## 2. テストケース一覧

### 2.1 DocumentSearcher クラス - 単体テスト

#### TC_001: コンストラクタテスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `constructor()` |
| **ケースID** | TC_001 |
| **事前条件（試験規格）** | DocumentSearcherクラスが定義されている |
| **判定条件（試験合格値）** | インスタンスが正常に生成され、documents配列が空配列で初期化される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- `new DocumentSearcher()`でインスタンス生成可能
- `documents`プロパティが空配列`[]`である

---

#### TC_002: ドキュメント追加テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `addDocument(title, path, content)` |
| **ケースID** | TC_002 |
| **事前条件（試験規格）** | DocumentSearcherインスタンスが生成済み |
| **判定条件（試験合格値）** | ドキュメントオブジェクトが配列に追加され、返り値がtrueである |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- 引数: `title="設計書.txt"`, `path="/docs/design.txt"`, `content="設計内容"`
- documents配列に1件追加される
- 追加されたオブジェクトは`{title, path, content}`の構造
- 返り値が`true`

---

#### TC_003: 単一キーワード検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_003 |
| **事前条件（試験規格）** | 3つのドキュメントが登録済み（"設計書.txt", "仕様書.txt", "議事録.txt"） |
| **判定条件（試験合格値）** | キーワード"設計"で検索時、"設計書.txt"のみが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
documents = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" },
  { title: "議事録.txt", path: "/documents/minutes.txt", content: "会議の内容と決定事項。" }
]
```

**検証項目:**
- `search("設計")`の結果が配列である
- 結果の長さが1
- 結果[0].titleが"設計書.txt"

---

#### TC_004: 複数結果検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_004 |
| **事前条件（試験規格）** | 内容に"システム"を含む複数ドキュメントが登録済み |
| **判定条件（試験合格値）** | 該当する全ドキュメントが配列で返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
documents = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" },
  { title: "議事録.txt", path: "/documents/minutes.txt", content: "会議の内容と決定事項。" }
]
```

**検証項目:**
- `search("システム")`の結果が配列である
- 結果の長さが2（"設計書.txt"と"仕様書.txt"）
- 全ての結果にcontentフィールドに"システム"が含まれる

---

#### TC_005: 検索結果なしテスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_005 |
| **事前条件（試験規格）** | ドキュメントが登録済み |
| **判定条件（試験合格値）** | 存在しないキーワードで検索時、空配列が返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `search("存在しないキーワード")`の結果が空配列`[]`
- 結果の長さが0

---

#### TC_006: 空文字検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(keyword)` |
| **ケースID** | TC_006 |
| **事前条件（試験規格）** | ドキュメントが登録済み |
| **判定条件（試験合格値）** | 空文字で検索時、全ドキュメントが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `search("")`の結果が全ドキュメントの配列
- 結果の長さが登録済みドキュメント数と一致

---

### 2.2 FileReader クラス - 単体テスト

#### TC_007: ファイル読み込み成功テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `readFile(path)` |
| **ケースID** | TC_007 |
| **事前条件（試験規格）** | 指定パスにtxtファイルが存在する |
| **判定条件（試験合格値）** | ファイル内容が文字列として返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- テスト用ファイルを一時的に作成
- `readFile(path)`の返り値が文字列
- 返り値がファイルの実際の内容と一致

---

#### TC_008: ファイル読み込み失敗テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `readFile(path)` |
| **ケースID** | TC_008 |
| **事前条件（試験規格）** | 指定パスにファイルが存在しない |
| **判定条件（試験合格値）** | エラーがthrowされ、エラーメッセージに"File not found"が含まれる |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- 存在しないパスを指定
- `readFile("/non/existent/path.txt")`がエラーをthrow
- エラーメッセージに"File not found"または"ENOENT"が含まれる

---

### 2.3 UIController クラス - 統合テスト

#### TC_009: 検索結果表示テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `displaySearchResults(results)` |
| **ケースID** | TC_009 |
| **事前条件（試験規格）** | DOM要素が準備済み、検索結果2件 |
| **判定条件（試験合格値）** | 結果リストに2つのアイテムが表示され、タイトルとパスが正しく表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
results = [
  { title: "設計書.txt", path: "/documents/design.txt", content: "システム設計に関する文書です。" },
  { title: "仕様書.txt", path: "/documents/spec.txt", content: "機能仕様とシステム要件を記載。" }
]
```

**検証項目:**
- DOM環境をjsdomでシミュレート
- 結果表示エリアに2つのリストアイテムが存在
- 各アイテムにタイトルとパスが正しく表示される

---

#### TC_010: ドキュメント表示テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `displayDocument(path)` |
| **ケースID** | TC_010 |
| **事前条件（試験規格）** | パスリンクがクリック可能状態 |
| **判定条件（試験合格値）** | クリック時に該当ドキュメントの内容が表示エリアに表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**検証項目:**
- FileReaderのモックを使用
- `displayDocument("/documents/design.txt")`を実行
- 表示エリアにドキュメント内容が表示される

---

#### TC_011: 検索実行テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `handleSearch()` |
| **ケースID** | TC_011 |
| **事前条件（試験規格）** | 検索フォームに"テスト"と入力済み |
| **判定条件（試験合格値）** | 検索ボタンクリック時、"テスト"を含むドキュメントが結果表示される |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**検証項目:**
- DocumentSearcherのモックを使用
- 検索フォームに"テスト"を入力
- `handleSearch()`を実行
- `displaySearchResults()`が呼ばれる

---

### 2.4 E2Eテスト

#### TC_012: 検索から表示までの一連操作

| 項目 | 内容 |
|------|------|
| **メソッド名** | E2E シナリオ |
| **ケースID** | TC_012 |
| **事前条件（試験規格）** | アプリケーション起動済み、サンプルドキュメント3件登録済み |
| **判定条件（試験合格値）** | 1. 検索欄に入力<br>2. 検索実行<br>3. 結果表示確認<br>4. パスクリック<br>5. 内容表示確認 |
| **テスト分類** | E2Eテスト |
| **優先度** | 高 |

**テストシナリオ:**
1. アプリケーションを起動
2. サンプルドキュメント3件を登録
3. 検索欄に"システム"と入力
4. 検索ボタンをクリック
5. 検索結果に2件表示されることを確認
6. 1件目のパスリンクをクリック
7. ドキュメント内容が表示エリアに表示されることを確認

**検証項目:**
- 全ての操作が正常に完了
- 各ステップで期待される状態になっている

---

## 3. テスト実行計画

### 3.1 実行順序

1. **単体テスト**（TC_001～TC_008）
   - DocumentSearcher クラス
   - FileReader クラス

2. **統合テスト**（TC_009～TC_011）
   - UIController クラス

3. **E2Eテスト**（TC_012）
   - 全体シナリオ

### 3.2 テストデータ

**サンプルドキュメント:**
```javascript
const testDocuments = [
  {
    title: "設計書.txt",
    path: "/documents/design.txt",
    content: "システム設計に関する文書です。"
  },
  {
    title: "仕様書.txt",
    path: "/documents/spec.txt",
    content: "機能仕様とシステム要件を記載。"
  },
  {
    title: "議事録.txt",
    path: "/documents/minutes.txt",
    content: "会議の内容と決定事項。"
  }
];
```

### 3.3 テスト環境

| 項目 | 内容 |
|------|------|
| OS | Linux / macOS / Windows |
| Node.js | v16以上 |
| Jest | v29以上 |
| Electron | v27以上 |
| テスト実行コマンド | `npm test` |

---

## 4. 判定基準

### 4.1 合格基準

- ✅ 全テストケース（TC_001～TC_012）が成功
- ✅ コードカバレッジ80%以上
- ✅ 重要機能（検索、ファイル読み込み）のカバレッジ100%
- ✅ エラーハンドリングが適切に実装されている

### 4.2 不合格時の対応

1. 失敗テストケースの原因調査
2. コードまたはテストの修正
3. 修正後、全テスト再実行
4. リグレッションテストの実施（既存テストが引き続き成功するか確認）

### 4.3 カバレッジ目標

| 分類 | 目標 |
|------|------|
| 全体 | 80%以上 |
| DocumentSearcher | 100% |
| FileReader | 100% |
| UIController | 80%以上 |

---

## 5. テストの独立性

### 5.1 原則

- 各テストは独立して実行可能
- テスト間の依存関係を排除
- テストデータの初期化・クリーンアップを確実に実施

### 5.2 実装方針

- `beforeEach`: 各テスト前にインスタンスを初期化
- `afterEach`: 各テスト後にモックをクリア
- 一時ファイルはテスト後に削除

---

## 6. 今後の拡張予定

### 6.1 次期バージョンでの追加テスト

| テスト項目 | 説明 | 優先度 |
|-----------|------|--------|
| docxファイル対応テスト | Word文書の読み込みと検索 | 高 |
| テスト結果のxlsxファイル出力 | テスト結果をExcel形式で出力 | 中 |
| 複数ファイル形式の混在テスト | txt, docx, pdf混在環境 | 中 |
| パフォーマンステスト | 1000件以上のドキュメント検索 | 低 |
| セキュリティテスト | XSS、パストラバーサル対策 | 高 |

### 6.2 継続的改善

- テストケースの定期的なレビュー
- カバレッジの向上
- テスト実行時間の短縮
- CI/CDパイプラインへの統合

---

## 7. 付録

### 7.1 テスト実行コマンド

```bash
# 全テスト実行
npm test

# カバレッジ付き実行
npm test -- --coverage

# 特定のテストのみ実行
npm test -- 単体テスト
npm test -- 統合テスト
npm test -- E2Eテスト

# ウォッチモード
npm test -- --watch
```

### 7.2 参考資料

- [Jest公式ドキュメント](https://jestjs.io/)
- [Electron Testing Guide](https://www.electronjs.org/docs/latest/tutorial/testing)
- TDD実施要領: `/TDD_v1/CLAUDE.md`

---

## 8. 追加機能テスト仕様（v2.0）

### 8.1 DatabaseManager クラス - 単体テスト

#### TC_013: データベース初期化テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `constructor(dbPath)`, `initialize()` |
| **ケースID** | TC_013 |
| **事前条件（試験規格）** | DBファイルが存在しない状態 |
| **判定条件（試験合格値）** | documentsテーブルが正常に作成される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- `new DatabaseManager(dbPath)`でインスタンス生成可能
- `initialize()`でテーブルが作成される
- テーブル構造が正しい（id, title, file_path, project_name, document_type, description, created_at, updated_at）

---

#### TC_014: ドキュメント登録テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `addDocument(doc)` |
| **ケースID** | TC_014 |
| **事前条件（試験規格）** | データベースが初期化済み |
| **判定条件（試験合格値）** | ドキュメントがDBに保存され、IDが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
doc = {
  title: "発注仕様書_プロジェクトA.docx",
  filePath: "\\\\fileserver\\docs\\project_a\\spec.docx",
  projectName: "プロジェクトA",
  documentType: "発注仕様書",
  description: "顧客向け発注仕様書"
}
```

**検証項目:**
- `addDocument(doc)`の返り値が数値（ID）
- DBに1件追加される
- 各フィールドが正しく保存される

---

#### TC_015: プロジェクト名による検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `searchByProjectName(projectName)` |
| **ケースID** | TC_015 |
| **事前条件（試験規格）** | 複数プロジェクトのドキュメントが登録済み |
| **判定条件（試験合格値）** | 指定プロジェクト名に一致するドキュメントのみ返却 |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
documents = [
  { title: "仕様書A", projectName: "プロジェクトA", documentType: "発注仕様書" },
  { title: "仕様書B", projectName: "プロジェクトB", documentType: "発注仕様書" },
  { title: "設計書A", projectName: "プロジェクトA", documentType: "設計書" }
]
```

**検証項目:**
- `searchByProjectName("プロジェクトA")`で2件返却
- 全結果のprojectNameが"プロジェクトA"

---

#### TC_016: 文書種類による検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `searchByDocumentType(documentType)` |
| **ケースID** | TC_016 |
| **事前条件（試験規格）** | 複数種類のドキュメントが登録済み |
| **判定条件（試験合格値）** | 指定文書種類に一致するドキュメントのみ返却 |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- `searchByDocumentType("発注仕様書")`で該当件数が返却
- 全結果のdocumentTypeが"発注仕様書"

---

#### TC_017: フリーテキスト検索テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `searchByKeyword(keyword)` |
| **ケースID** | TC_017 |
| **事前条件（試験規格）** | ドキュメントが登録済み |
| **判定条件（試験合格値）** | title, file_path, descriptionのいずれかにキーワードを含むドキュメントが返却 |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**検証項目:**
- `searchByKeyword("顧客")`でdescriptionに"顧客"を含むドキュメントが返却
- `searchByKeyword("仕様書")`でtitleに"仕様書"を含むドキュメントが返却

---

#### TC_018: 複合検索テスト（タグ＋フリーテキスト）

| 項目 | 内容 |
|------|------|
| **メソッド名** | `search(options)` |
| **ケースID** | TC_018 |
| **事前条件（試験規格）** | 複数ドキュメントが登録済み |
| **判定条件（試験合格値）** | タグとキーワードの両方の条件を満たすドキュメントのみ返却 |
| **テスト分類** | 単体テスト |
| **優先度** | 高 |

**テストデータ:**
```javascript
options = {
  projectName: "プロジェクトA",
  documentType: "発注仕様書",
  keyword: "顧客"
}
```

**検証項目:**
- 全ての条件を満たすドキュメントのみ返却
- 部分的に条件を満たすドキュメントは除外

---

### 8.2 LockManager クラス - 単体テスト

#### TC_019: ロック取得テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `acquireLock()` |
| **ケースID** | TC_019 |
| **事前条件（試験規格）** | ロックファイルが存在しない状態 |
| **判定条件（試験合格値）** | .lockファイルが作成され、trueが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `acquireLock()`がtrueを返す
- .lockファイルが作成される
- ロックファイルにタイムスタンプが記録される

---

#### TC_020: ロック解放テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `releaseLock()` |
| **ケースID** | TC_020 |
| **事前条件（試験規格）** | ロックが取得済み |
| **判定条件（試験合格値）** | .lockファイルが削除され、trueが返却される |
| **テスト分類** | 単体テスト |
| **優先度** | 中 |

**検証項目:**
- `releaseLock()`がtrueを返す
- .lockファイルが削除される

---

### 8.3 Logger クラス - 単体テスト

#### TC_021: ログ出力テスト

| 項目 | 内容 |
|------|------|
| **メソッド名** | `log(level, message)` |
| **ケースID** | TC_021 |
| **事前条件（試験規格）** | ログファイルが存在しない状態 |
| **判定条件（試験合格値）** | ログファイルにタイムスタンプ付きメッセージが追記される |
| **テスト分類** | 単体テスト |
| **優先度** | 低 |

**検証項目:**
- `log("INFO", "テストメッセージ")`でログファイルに出力
- タイムスタンプが含まれる
- ログレベル（INFO, WARN, ERROR）が正しく出力

---

### 8.4 統合テスト - UI連携

#### TC_022: UIからのドキュメント登録・検索フロー

| 項目 | 内容 |
|------|------|
| **メソッド名** | E2E シナリオ |
| **ケースID** | TC_022 |
| **事前条件（試験規格）** | データベースが空の状態 |
| **判定条件（試験合格値）** | 1. 登録フォームから入力<br>2. 登録実行<br>3. 検索条件入力<br>4. 検索実行<br>5. 結果にファイルパス表示 |
| **テスト分類** | 統合テスト |
| **優先度** | 高 |

**テストシナリオ:**
1. 登録フォームに以下を入力
   - タイトル: "発注仕様書_プロジェクトA"
   - ファイルパス: "\\\\fileserver\\docs\\spec.docx"
   - プロジェクト名: "プロジェクトA"
   - 文書種類: "発注仕様書"
   - 説明: "顧客向け仕様書"
2. 登録ボタンクリック
3. プロジェクト名で検索
4. 結果にファイルパスが表示されることを確認

---

## 9. v2.0 テスト実行計画

### 9.1 実行順序

1. **単体テスト - 新規クラス**（TC_013～TC_021）
   - DatabaseManager クラス
   - LockManager クラス
   - Logger クラス

2. **統合テスト**（TC_022）
   - UIからのDB操作フロー

### 9.2 合格基準（v2.0追加分）

- ✅ 全テストケース（TC_013～TC_022）が成功
- ✅ DatabaseManagerのカバレッジ90%以上
- ✅ 検索機能が正常動作

---

**更新日:** 2025-12-05
**バージョン:** 2.0
**作成者:** Claude Code
