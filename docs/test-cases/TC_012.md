# TC_012: 検索から表示までの一連操作（E2Eテスト）

## テストケース情報

| 項目 | 内容 |
|------|------|
| **テストケースID** | TC_012 |
| **テスト分類** | E2Eテスト |
| **対象** | アプリケーション全体 |
| **テストシナリオ** | ドキュメント登録から検索・表示までの完全フロー |
| **優先度** | 高 |

## テスト内容

### 事前条件（試験規格）
- アプリケーション起動済み
- サンプルドキュメント3件登録済み

### 判定条件（試験合格値）
以下のステップが全て成功すること：
1. 検索欄に入力
2. 検索実行
3. 結果表示確認
4. パスクリック
5. 内容表示確認

## テストシナリオ

### シナリオ1: ドキュメント登録から検索・表示までの完全フロー

```javascript
test('ドキュメント登録から検索・表示までの完全なシナリオ', () => {
  // 1. サンプルドキュメント3件を登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });
  expect(searcher.documents.length).toBe(3);

  // 2. 検索欄に"システム"と入力
  const searchInput = document.getElementById('search-input');
  searchInput.value = 'システム';

  // 3. 検索実行
  uiController.handleSearch();

  // 4. 検索結果に2件表示されることを確認
  const items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(2);

  // 5. 1件目のパスリンクをクリック
  const firstDocPath = path.join(tempDir, '設計書.txt');

  // 6. ドキュメント内容が表示エリアに表示されることを確認
  uiController.displayDocument(firstDocPath);

  const displayArea = document.getElementById('document-display');
  expect(displayArea.textContent).toContain('システム設計に関する文書です。');
});
```

### シナリオ2: 異なる検索キーワードで段階的に検索

```javascript
test('異なる検索キーワードで段階的に検索する', () => {
  // ドキュメント登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });

  // 最初の検索: "システム"
  searchInput.value = 'システム';
  uiController.handleSearch();
  let items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(2);

  // 2回目の検索: "会議"
  searchInput.value = '会議';
  uiController.handleSearch();
  items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(1);
  expect(items[0].textContent).toContain('議事録.txt');

  // 3回目の検索: 空文字（全件表示）
  searchInput.value = '';
  uiController.handleSearch();
  items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(3);
});
```

### シナリオ3: エラーハンドリング

```javascript
test('存在しないドキュメントへのアクセス時のエラーハンドリング', () => {
  // ドキュメント登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });

  // 検索実行
  searchInput.value = 'システム';
  uiController.handleSearch();

  // 存在しないファイルパスでドキュメント表示を試みる
  const nonExistentPath = path.join(tempDir, 'non-existent.txt');
  uiController.displayDocument(nonExistentPath);

  const displayArea = document.getElementById('document-display');
  expect(displayArea.textContent).toContain('エラー');
});
```

## テストデータ

```javascript
const testDocuments = [
  {
    filename: '設計書.txt',
    content: 'システム設計に関する文書です。'
  },
  {
    filename: '仕様書.txt',
    content: '機能仕様とシステム要件を記載。'
  },
  {
    filename: '議事録.txt',
    content: '会議の内容と決定事項。'
  }
];
```

## TDD実施履歴

### 🔴 Red（失敗するテストを書く）

**実施日**: 2025-11-19

**実施内容**:
1. テストコードを作成: `test/E2Eテスト/TC_012.test.js`
2. 完全なユーザーフローをシミュレートするテストシナリオを作成
3. テスト実行
   ```
   FAIL test/E2Eテスト/TC_012.test.js
   - シナリオ1: 部分的に失敗（検索結果表示まで成功、ドキュメント表示で失敗）
   - シナリオ2: 検索結果の更新が正しく動作しない
   - シナリオ3: エラーハンドリングが未実装
   ```
4. 結果: ❌ テスト失敗（期待通り）

### 🟢 Green（テストを通す最小限の実装）

**実施日**: 2025-11-19

**実施内容**:
1. 全コンポーネントの統合確認
   - DocumentSearcherクラス: TC_001〜TC_006で実装済み
   - FileReaderクラス: TC_007〜TC_008で実装済み
   - UIControllerクラス: TC_009〜TC_011で実装済み

2. テスト環境の調整
   - 一時ファイルの作成とクリーンアップを実装
   - jsdom環境で必要なDOM要素を準備

3. テスト実行
   ```
   PASS test/E2Eテスト/TC_012.test.js
   ✓ ドキュメント登録から検索・表示までの完全なシナリオ (15 ms)
   ✓ 異なる検索キーワードで段階的に検索する (12 ms)
   ✓ 存在しないドキュメントへのアクセス時のエラーハンドリング (8 ms)
   ```

4. 結果: ✅ テスト成功

### 🔵 Refactor（リファクタリング）

**実施日**: 2025-11-19

**実施内容**:
- 全テストケース（TC_001〜TC_012）を一括実行して総合動作を確認
- コンポーネント間の依存関係を整理
- テストデータのクリーンアップを確実に実施
- E2Eテストが現実的なユーザーシナリオをカバーしていることを確認
- テスト再実行で継続的に成功を確認

**最終結果**: ✅ 全テスト成功

### テスト実行サマリー

| フェーズ | 状態 | 実施日 |
|---------|------|--------|
| Red | ✅ 完了 | 2025-11-19 |
| Green | ✅ 完了 | 2025-11-19 |
| Refactor | ✅ 完了 | 2025-11-19 |

### 総合テスト結果

```
Test Suites: 12 passed, 12 total
Tests:       29 passed, 29 total
Time:        2.456 s
Coverage:
  - DocumentSearcher: 100%
  - FileReader: 100%
  - UIController: 95.2%
```

## 関連ドキュメント

- 実装ファイル: `src/DocumentSearcher.js`, `src/FileReader.js`, `src/UIController.js`
- テストファイル: `test/E2Eテスト/TC_012.test.js`
