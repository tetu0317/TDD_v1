# TC_012: 検索から表示までの一連操作（E2Eテスト）

## テストケース情報

| 項目 | 内容 |
|------|------|
| **テストケースID** | TC_012 |
| **テスト分類** | E2Eテスト |
| **対象** | アプリケーション全体 |
| **テストシナリオ** | ドキュメント登録から検索・表示までの完全フロー |
| **優先度** | 高 |

## テスト内容

### 事前条件（試験規格）
- アプリケーション起動済み
- サンプルドキュメント3件登録済み

### 判定条件（試験合格値）
以下のステップが全て成功すること：
1. 検索欄に入力
2. 検索実行
3. 結果表示確認
4. パスクリック
5. 内容表示確認

## テストシナリオ

### シナリオ1: ドキュメント登録から検索・表示までの完全フロー

```javascript
test('ドキュメント登録から検索・表示までの完全なシナリオ', () => {
  // 1. サンプルドキュメント3件を登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });
  expect(searcher.documents.length).toBe(3);

  // 2. 検索欄に"システム"と入力
  const searchInput = document.getElementById('search-input');
  searchInput.value = 'システム';

  // 3. 検索実行
  uiController.handleSearch();

  // 4. 検索結果に2件表示されることを確認
  const items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(2);

  // 5. 1件目のパスリンクをクリック
  const firstDocPath = path.join(tempDir, '設計書.txt');

  // 6. ドキュメント内容が表示エリアに表示されることを確認
  uiController.displayDocument(firstDocPath);

  const displayArea = document.getElementById('document-display');
  expect(displayArea.textContent).toContain('システム設計に関する文書です。');
});
```

### シナリオ2: 異なる検索キーワードで段階的に検索

```javascript
test('異なる検索キーワードで段階的に検索する', () => {
  // ドキュメント登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });

  // 最初の検索: "システム"
  searchInput.value = 'システム';
  uiController.handleSearch();
  let items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(2);

  // 2回目の検索: "会議"
  searchInput.value = '会議';
  uiController.handleSearch();
  items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(1);
  expect(items[0].textContent).toContain('議事録.txt');

  // 3回目の検索: 空文字（全件表示）
  searchInput.value = '';
  uiController.handleSearch();
  items = document.querySelectorAll('.result-item');
  expect(items.length).toBe(3);
});
```

### シナリオ3: エラーハンドリング

```javascript
test('存在しないドキュメントへのアクセス時のエラーハンドリング', () => {
  // ドキュメント登録
  testFiles.forEach(file => {
    const filePath = path.join(tempDir, file.filename);
    searcher.addDocument(file.filename, filePath, file.content);
  });

  // 検索実行
  searchInput.value = 'システム';
  uiController.handleSearch();

  // 存在しないファイルパスでドキュメント表示を試みる
  const nonExistentPath = path.join(tempDir, 'non-existent.txt');
  uiController.displayDocument(nonExistentPath);

  const displayArea = document.getElementById('document-display');
  expect(displayArea.textContent).toContain('エラー');
});
```

## テストデータ

```javascript
const testDocuments = [
  {
    filename: '設計書.txt',
    content: 'システム設計に関する文書です。'
  },
  {
    filename: '仕様書.txt',
    content: '機能仕様とシステム要件を記載。'
  },
  {
    filename: '議事録.txt',
    content: '会議の内容と決定事項。'
  }
];
```

## テスト実行結果

- [ ] テスト実行前（Red）
- [ ] テスト成功（Green）
- [ ] リファクタリング完了（Refactor）

## 関連ドキュメント

- 実装ファイル: `src/DocumentSearcher.js`, `src/FileReader.js`, `src/UIController.js`
- テストファイル: `test/E2Eテスト/TC_012.test.js`
